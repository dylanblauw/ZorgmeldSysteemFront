@using Microsoft.AspNetCore.Components.Authorization
@using ZorgmeldSysteem.Blazor.Services.Auth
@inject CustomAuthenticationStateProvider AuthStateProvider
@inject NavigationManager Navigation

<AuthorizeView>
    <Authorized>
        <div class="dropdown">
            <button class="btn btn-outline-dark dropdown-toggle"
                    type="button"
                    @onclick="ToggleDropdown">
                <i class="bi bi-person-circle"></i> @context.User.Identity?.Name
            </button>
            @if (isDropdownOpen)
            {
                <ul class="dropdown-menu dropdown-menu-end show">
                    <li>
                        <span class="dropdown-item-text">
                            <small class="text-muted">Ingelogd als:</small><br />
                            <strong>@context.User.Identity?.Name</strong><br />
                            <small>@GetUserRole(context)</small>
                        </span>
                    </li>
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <a class="dropdown-item" href="/logout">
                            <i class="bi bi-box-arrow-right"></i> Uitloggen
                        </a>
                    </li>
                </ul>
            }
        </div>
    </Authorized>
    <NotAuthorized>
        <a class="btn btn-primary" href="/login">
            <i class="bi bi-box-arrow-in-right"></i> Inloggen
        </a>
    </NotAuthorized>
</AuthorizeView>

@code {
    private bool isDropdownOpen = false;

    private void ToggleDropdown()
    {
        isDropdownOpen = !isDropdownOpen;
    }

    private string GetUserRole(AuthenticationState state)
    {
        var roleClaim = state.User.Claims.FirstOrDefault(c => c.Type == System.Security.Claims.ClaimTypes.Role);
        return roleClaim?.Value ?? "Onbekend";
    }
}