stages:
  - build

variables:
  DOTNET_VERSION: "8.0"
  # Performance optimalisaties
  DOTNET_CLI_TELEMETRY_OPTOUT: "1"
  DOTNET_SKIP_FIRST_TIME_EXPERIENCE: "1"
  NUGET_PACKAGES: "$CI_PROJECT_DIR/.nuget"

# Globale timeout
default:
  timeout: 30m

# Cache voor snellere builds
cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - .nuget/

before_script:
  - dotnet --version
  - echo "Starting build process..."

# Build de Blazor app
build-blazor:
  stage: build
  image: mcr.microsoft.com/dotnet/sdk:8.0
  timeout: 20m
  script:
    - echo "Building Blazor frontend..."
    - dotnet restore ZorgmeldSysteem.Blazor/ZorgmeldSysteem.Blazor.csproj --verbosity minimal
    - dotnet build ZorgmeldSysteem.Blazor/ZorgmeldSysteem.Blazor.csproj --no-restore --configuration Release --verbosity minimal
  artifacts:
    paths:
      - ZorgmeldSysteem.Blazor/bin/Release/
    expire_in: 1 hour
  retry:
    max: 2
    when:
      - runner_system_failure
      - stuck_or_timeout_failure